<!-- Fondo oscuro -->
<div *ngIf="mostrarModal()" (click)="cerrarModal()" class="fixed inset-0 z-40 bg-black opacity-25"></div>
<!-- Modal -->
<div *ngIf="mostrarModal()" class="overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none justify-center items-center flex modal-fade-down">
    <div (click)="$event.stopPropagation()" class="relative mx-auto my-6 bg-white rounded-lg shadow-lg max-w-4xl w-full">
    <!-- Título del modal -->
    <div class="flex items-start justify-between p-5 border-b border-solid border-blueGray-200 rounded-t">
      <h3 class="text-xl font-semibold">
        Adjuntar Documentos a Proyecto
      </h3>
    </div>
    <!-- Contenido del modal -->
    <div class="relative p-6 flex-auto">
      
      <!-- TABLA DE DOCUMENTOS EXISTENTES -->
      <div *ngIf="urlDocumentos && urlDocumentos.length > 0" class="mb-6">
        <h4 class="text-lg font-semibold mb-3 text-gray-700">Documentos Adjuntos ({{ urlDocumentos.length }})</h4>
        <div class="overflow-x-auto border border-gray-300 rounded-lg" style="max-height: 250px; overflow-y: auto;">
          <table class="min-w-full bg-white">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b">#</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b">Nombre del Archivo</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-b">Tipo</th>
                <th class="px-4 py-2 text-center text-xs font-medium text-gray-700 uppercase tracking-wider border-b">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let url of urlDocumentos; let i = index" class="hover:bg-gray-50">
                <td class="px-4 py-3 border-b text-sm text-gray-700">{{ i + 1 }}</td>
                <td class="px-4 py-3 border-b text-sm text-gray-700">
                  {{ obtenerNombreArchivo(url) }}
                </td>
                <td class="px-4 py-3 border-b text-sm text-gray-700">
                  <span class="px-2 py-1 text-xs rounded-full" [ngClass]="obtenerClaseExtension(url)">
                    {{ obtenerExtension(url) }}
                  </span>
                </td>
                <td class="px-4 py-3 border-b text-sm text-center">
                  <button 
                    (click)="verDocumento(url)" 
                    class="text-blue-600 hover:text-blue-800 mr-3"
                    title="Ver documento">
                    <svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                  </button>
                  <button 
                    (click)="eliminarDocumento(i)" 
                    class="text-red-600 hover:text-red-800"
                    title="Eliminar documento">
                    <svg class="w-5 h-5 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- SECCIÓN DE CARGA DE NUEVOS DOCUMENTOS -->
      <div class="flex flex-wrap mb-4">
        <div class="w-full lg:w-12/12 px-2">
          <h4 class="text-lg font-semibold mb-3 text-gray-700">Agregar Documento</h4>
          <div class="upload-container">
            @if (previewUrl) {
             
            }
     
            <div class="button-container">
              <input
                type="file"
                #fileInput
                (change)="onFileSelected($event)"
                accept=".png, .jpg, .jpeg, .pdf, .doc, .docx, .zip, .rar, .xlsx, .ppt, .pptx"
                style="display: none"
              >
             
              <button
                (click)="fileInput.click()"
                class="select-button"
                [disabled]="uploading">
                Seleccionar Archivo
              </button>
     
              @if (uploading) {
                <div class="progress-container">
                  <div
                    class="progress-bar"
                    [style.width.%]="uploadProgress">
                    {{ uploadProgress }}%
                  </div>
                </div>
              }
            </div>
     
            @if (errorMessage) {
              <div class="error-message">
                {{ errorMessage }}
              </div>
            }
        </div>
        <!-- Mensaje al completar la carga -->
        <div class="text-sm text-gray-700 mt-4 ml-4 italic">
          <p>Recomendaciones:</p>
          <ul class="list-disc list-inside">
            <li>Formatos permitidos: documentos ofimáticos (Word, Excel, PDF, Zip, PowerPoint y Rar)</li>
            <li>Tamaño máximo: 20 MB</li>
          </ul>
        </div>
        </div>
      </div>
    </div>
    <!--footer-->
    <div class="flex items-center justify-end p-5 border-t border-solid border-blueGray-200 rounded-b">
      <button class="bg-emerald-500 text-white active:bg-emerald-600 font-bold uppercase text-sm px-6 py-3 rounded shadow hover:shadow-lg outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150" type="button" (click)="cerrarModal()">
        Cerrar
      </button>
    </div>
  </div>
</div>
@if (_alerta.showAlert) {
  <app-alerta-informativo
      [type]="_alerta.alertType"
      [message]="_alerta.alertMessage">
  </app-alerta-informativo>
}
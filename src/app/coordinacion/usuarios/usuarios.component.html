<div class="space-y-6">

  <!-- Header + botón -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800">Usuarios</h1>
    <div class="flex gap-2">
      <button (click)="crearNuevoUsuario()" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition">
        ➕ Nuevo Estudiante
      </button>
      <button (click)="crearNuevoDocente()" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition">
        ➕ Nuevo Docente
      </button>
    </div>
  </div>

  <!-- Header -->
  <div class="flex justify-between items-center mb-5 bg-gray-50 p-2 rounded-lg shadow-sm">
    <div class="flex gap-2">
      <button 
        *ngFor="let filter of filterButtons" 
        class="px-4 py-1 rounded-md border transition-all"
        [class]="activeFilter === filter.value ? 'bg-purple-600 text-white border-purple-600' : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-50'"
        (click)="setFilter(filter.value)">
        {{ filter.label }}
      </button>
    </div>
    
    <div class="relative w-80">
      <input 
        type="text" 
        class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        placeholder="Buscar colaborador"
        [(ngModel)]="searchText"
        (input)="onSearchChange()">
      <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
    </div>
  </div>

  <!-- Tabla de usuarios -->
  <div class="bg-white p-6 shadow rounded-xl overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Nombre</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Email</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Programa / Especialidad</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        @for(usuario of usuarios; track $index) {
        <tr>
          <td (click)="abrirModalUsuario(usuario)" class="px-6 py-4 text-gray-800">{{ usuario.nombreUsuario }}</td>
          <td (click)="abrirModalUsuario(usuario)" class="px-6 py-4 text-gray-600">{{ usuario.correoInstitucional }}</td>
          <td (click)="abrirModalUsuario(usuario)" class="px-6 py-4 text-gray-600 capitalize">{{ usuario.programa }}</td>
          <td class="px-6 py-4">
            <button (click)="editarUsuario(usuario)" class="text-blue-600 hover:underline mr-2">Editar</button>
            <button (click)="eliminarUsuario(usuario)" class="text-red-600 hover:underline">Eliminar</button>
          </td>
        </tr>
        }@empty {
          <tr>
            <td colspan="4" class="px-6 py-4 text-center">No hay usuarios</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Modal Crear / Editar -->
  <div 
    *ngIf="usuarioSeleccionado()" 
    class="fixed inset-0  bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="cerrarModalUsuario()"
  >
    <div 
      class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto"
      (click)="$event.stopPropagation()"
    >
      <!-- Header del modal -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div
            class="w-4 h-4 rounded-full"
            [ngClass]="getColorEstado(usuarioSeleccionado()!.status)"
          ></div>
          <h2 class="text-lg font-semibold text-gray-900 truncate max-w-xs">{{ usuarioSeleccionado()!.nombreUsuario }}</h2>
        </div>
        <button 
          (click)="cerrarModalUsuario()"
          class="text-gray-400 hover:text-gray-600 transition-colors"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Contenido del modal -->
      <div class="p-6 space-y-4">
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Fecha:</h4>
          <p class="text-gray-600 text-sm">
            <!-- {{ actividadSeleccionada()!.dia }} de {{ meses[actividadSeleccionada()!.mes] }}--> 2025 
          </p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Estado:</h4>
          <span 
            class="capitalize font-medium"
            [ngClass]="getTextColorEstado(usuarioSeleccionado()!.status)"
          >
            {{ usuarioSeleccionado()!.status }}
          </span>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Objetivo:</h4>
          <p class="text-gray-600 text-sm">{{ usuarioSeleccionado()!.objetivodescripcion }}</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Responsable:</h4>
          <p class="text-gray-600 text-sm">{{ usuarioSeleccionado()!.responsable }}</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Indicador:</h4>
          <p class="text-gray-600 text-sm">{{ usuarioSeleccionado()!.descripcionindicator }}</p>
        </div>
        <div>
          <h4 class="font-semibold text-gray-800 mb-1">Meta / Valor Actual:</h4>
          <p class="text-gray-600 text-sm">{{ usuarioSeleccionado()!.valorReal }} / {{ usuarioSeleccionado()!.meta }}</p>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Modal Crear / Editar -->
<app-nuevo-usuarios #modalNuevoEditar></app-nuevo-usuarios>

<!-- Modal Eliminar -->
<app-eliminar-usuarios #modalEliminar></app-eliminar-usuarios>

<!-- Modal Crear / Editar -->
<app-nuevo-docentes #modalNuevoDocentes></app-nuevo-docentes>

